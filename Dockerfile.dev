# MLOps 프로젝트 - 개발환경 Docker 이미지 (2단계 피처 스토어 업데이트)
FROM python:3.11-slim

# 메타데이터
LABEL maintainer="MLOps Project Team"
LABEL version="2.0.0"
LABEL description="MLOps Cloud Project - Development Environment with Feature Store"

# 환경변수 설정
ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONPATH=/app/src

# 작업 디렉토리 설정
WORKDIR /app

# 시스템 패키지 업데이트 및 필수 도구 설치
# 2단계 피처 스토어에 필요한 시스템 패키지 추가
RUN apt-get update && apt-get install -y \
    curl \
    git \
    vim \
    htop \
    jq \
    tree \
    build-essential \
    libpq-dev \
    redis-tools \
    && rm -rf /var/lib/apt/lists/*

# Python 의존성 파일 복사
COPY requirements.txt requirements-dev.txt ./
COPY docs/02-feature-store/requirements.txt ./docs-requirements.txt

# Python 패키지 설치 (2단계 업데이트된 requirements)
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r requirements-dev.txt && \
    pip install --no-cache-dir -r docs-requirements.txt

# 애플리케이션 코드 복사
COPY . .

# 필요한 디렉토리 생성 (2단계 피처 스토어용)
RUN mkdir -p \
    data/raw \
    data/processed \
    data/test \
    data/feature_store \
    logs \
    reports \
    feature_repo/data \
    config/prometheus \
    config/grafana \
    config/postgres

# 개발용 포트 노출 (2단계 업데이트)
EXPOSE 8000 8001 8002 8888 8080 9090 3000

# 개발 환경 진입점
CMD ["bash"]
