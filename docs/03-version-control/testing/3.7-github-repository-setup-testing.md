# 3.7 GitHub Repository Setup 테스트 가이드

## 📋 테스트 개요

**목표**: GitHub 저장소 설정 및 권한 관리 시스템의 모든 기능이 정상 작동하는지 검증
**테스트 범위**: 저장소 메타데이터, 이슈/PR 템플릿, CODEOWNERS, 라벨 시스템, 자동화 스크립트
**예상 소요 시간**: 30-45분

---

## 🧪 사전 준비

### 환경 설정 확인

```bash
# WSL Ubuntu 환경에서 실행
cd /mnt/c/dev/movie-mlops

# 현재 상태 확인
pwd
git status
git remote -v

# Git 설정 확인
echo "Git 사용자 설정:"
git config user.name
git config user.email

# GitHub 관련 환경 변수 확인 (선택적)
echo "GitHub 환경 변수 (설정된 경우):"
echo "GITHUB_TOKEN: ${GITHUB_TOKEN:+설정됨}"
echo "GITHUB_REPO: ${GITHUB_REPO:-설정되지 않음}"
```

---

## 🎯 테스트 시나리오 1: 저장소 기본 파일 검증

### 1.1 필수 저장소 파일 존재 확인

```bash
echo "📄 저장소 기본 파일 존재 확인..."

# 필수 파일들 확인
essential_files=(
    "README.md"
    "CONTRIBUTING.md"
    "LICENSE"
    ".gitignore"
)

for file in "${essential_files[@]}"; do
    if [ -f "$file" ]; then
        echo "✅ $file 존재"
        
        # 파일 크기 확인 (빈 파일이 아닌지)
        if [ -s "$file" ]; then
            echo "  └─ 내용 있음 ($(wc -l < "$file") 라인)"
        else
            echo "  └─ ⚠️ 빈 파일"
        fi
    else
        echo "❌ $file 없음"
    fi
done
```

### 1.2 README.md 내용 품질 검증

```bash
echo "📖 README.md 내용 품질 검증..."

if [ -f "README.md" ]; then
    echo "1. README.md 필수 섹션 확인:"
    
    # 필수 섹션들 확인
    sections=(
        "Movie MLOps Project"
        "프로젝트 개요"
        "MLOps"
        "빠른 시작"
        "설치"
        "사용법"
        "기여"
        "라이선스"
    )
    
    for section in "${sections[@]}"; do
        if grep -q "$section" README.md; then
            echo "  ✅ '$section' 섹션 포함"
        else
            echo "  ⚠️ '$section' 섹션 누락"
        fi
    done
    
    echo ""
    echo "2. 뱃지 및 링크 확인:"
    if grep -q "badge" README.md || grep -q "shields.io" README.md; then
        echo "  ✅ 상태 뱃지 포함"
    else
        echo "  ⚠️ 상태 뱃지 없음"
    fi
    
    if grep -q "github.com" README.md; then
        echo "  ✅ GitHub 링크 포함"
    else
        echo "  ⚠️ GitHub 링크 없음"
    fi
    
    echo ""
    echo "3. 파일 크기 및 가독성:"
    line_count=$(wc -l < README.md)
    word_count=$(wc -w < README.md)
    
    echo "  - 라인 수: $line_count"
    echo "  - 단어 수: $word_count"
    
    if [ $line_count -gt 50 ] && [ $word_count -gt 200 ]; then
        echo "  ✅ 충분한 내용"
    else
        echo "  ⚠️ 내용 보완 필요"
    fi
    
else
    echo "❌ README.md 파일이 없습니다"
fi
```

---

## 🎯 테스트 시나리오 2: GitHub 템플릿 검증

### 2.1 이슈 템플릿 확인

```bash
echo "🐛 GitHub 이슈 템플릿 확인..."

# .github/ISSUE_TEMPLATE 디렉터리 확인
if [ -d ".github/ISSUE_TEMPLATE" ]; then
    echo "✅ 이슈 템플릿 디렉터리 존재"
    
    echo ""
    echo "이슈 템플릿 파일들:"
    ls -la .github/ISSUE_TEMPLATE/
    
    # 버그 리포트 템플릿 확인
    if [ -f ".github/ISSUE_TEMPLATE/bug_report.yml" ]; then
        echo ""
        echo "1. 버그 리포트 템플릿 검증:"
        
        # YAML 유효성 검사
        python -c "
import yaml
try:
    with open('.github/ISSUE_TEMPLATE/bug_report.yml', 'r') as f:
        template = yaml.safe_load(f)
    print('✅ bug_report.yml YAML 형식 유효')
    
    # 필수 필드 확인
    required_fields = ['name', 'description', 'body']
    for field in required_fields:
        if field in template:
            print(f'  ✅ {field} 필드 존재')
        else:
            print(f'  ❌ {field} 필드 누락')
            
except Exception as e:
    print(f'❌ bug_report.yml 오류: {e}')
"
    else
        echo "❌ 버그 리포트 템플릿 없음"
    fi
    
    # 기능 요청 템플릿 확인
    if [ -f ".github/ISSUE_TEMPLATE/feature_request.yml" ]; then
        echo ""
        echo "2. 기능 요청 템플릿 검증:"
        
        python -c "
import yaml
try:
    with open('.github/ISSUE_TEMPLATE/feature_request.yml', 'r') as f:
        template = yaml.safe_load(f)
    print('✅ feature_request.yml YAML 형식 유효')
    
    # 기능 요청 특화 필드 확인
    if 'body' in template:
        body_items = template['body']
        has_problem = any('problem' in str(item).lower() for item in body_items)
        has_solution = any('solution' in str(item).lower() for item in body_items)
        
        if has_problem:
            print('  ✅ 문제 설명 필드 존재')
        if has_solution:
            print('  ✅ 해결책 필드 존재')
            
except Exception as e:
    print(f'❌ feature_request.yml 오류: {e}')
"
    else
        echo "❌ 기능 요청 템플릿 없음"
    fi
    
else
    echo "❌ 이슈 템플릿 디렉터리 없음"
fi
```

### 2.2 Pull Request 템플릿 확인

```bash
echo "🔀 Pull Request 템플릿 확인..."

if [ -f ".github/PULL_REQUEST_TEMPLATE.md" ]; then
    echo "✅ PR 템플릿 파일 존재"
    
    echo ""
    echo "1. PR 템플릿 필수 섹션 확인:"
    
    # 필수 섹션들 확인
    pr_sections=(
        "변경 사항"
        "이슈"
        "테스트"
        "체크리스트"
        "리뷰"
    )
    
    for section in "${pr_sections[@]}"; do
        if grep -iq "$section" .github/PULL_REQUEST_TEMPLATE.md; then
            echo "  ✅ '$section' 섹션 포함"
        else
            echo "  ⚠️ '$section' 섹션 누락"
        fi
    done
    
    echo ""
    echo "2. 체크박스 및 인터랙티브 요소 확인:"
    checkbox_count=$(grep -c "\[ \]" .github/PULL_REQUEST_TEMPLATE.md)
    echo "  - 체크박스 수: $checkbox_count"
    
    if [ $checkbox_count -gt 5 ]; then
        echo "  ✅ 충분한 체크리스트 항목"
    else
        echo "  ⚠️ 체크리스트 항목 보완 필요"
    fi
    
    echo ""
    echo "3. MLOps 특화 내용 확인:"
    if grep -iq "docker\|model\|data\|ml" .github/PULL_REQUEST_TEMPLATE.md; then
        echo "  ✅ MLOps 관련 내용 포함"
    else
        echo "  ⚠️ MLOps 관련 내용 부족"
    fi
    
else
    echo "❌ PR 템플릿 파일 없음"
fi
```

---

## 🎯 테스트 시나리오 3: CODEOWNERS 설정 검증

### 3.1 CODEOWNERS 파일 검증

```bash
echo "👥 CODEOWNERS 파일 검증..."

if [ -f ".github/CODEOWNERS" ]; then
    echo "✅ CODEOWNERS 파일 존재"
    
    echo ""
    echo "1. CODEOWNERS 구조 확인:"
    line_count=$(wc -l < .github/CODEOWNERS)
    echo "  - 총 라인 수: $line_count"
    
    # 주석 라인 제외한 실제 규칙 수
    rule_count=$(grep -v '^#' .github/CODEOWNERS | grep -v '^$' | wc -l)
    echo "  - 실제 규칙 수: $rule_count"
    
    if [ $rule_count -gt 5 ]; then
        echo "  ✅ 충분한 소유권 규칙"
    else
        echo "  ⚠️ 소유권 규칙 보완 필요"
    fi
    
    echo ""
    echo "2. MLOps 특화 경로 규칙 확인:"
    mlops_paths=(
        "/docs/"
        "/src/data/"
        "/src/features/"
        "/scripts/"
        "/config/"
        "/tests/"
        "Dockerfile"
        ".github/"
    )
    
    for path in "${mlops_paths[@]}"; do
        if grep -q "$path" .github/CODEOWNERS; then
            echo "  ✅ '$path' 경로 규칙 존재"
        else
            echo "  ⚠️ '$path' 경로 규칙 누락"
        fi
    done
    
    echo ""
    echo "3. 소유자 형식 검증:"
    # @로 시작하는 사용자/팀 참조 확인
    owner_count=$(grep -o '@[a-zA-Z0-9_-]*' .github/CODEOWNERS | sort -u | wc -l)
    echo "  - 고유 소유자 수: $owner_count"
    
    if [ $owner_count -gt 0 ]; then
        echo "  ✅ 소유자 지정됨"
        echo "  소유자 목록:"
        grep -o '@[a-zA-Z0-9_-]*' .github/CODEOWNERS | sort -u | head -5
    else
        echo "  ⚠️ 소유자 지정 필요"
    fi
    
else
    echo "❌ CODEOWNERS 파일 없음"
fi
```

---

## 🎯 테스트 시나리오 4: 라벨 설정 스크립트 테스트

### 4.1 라벨 설정 스크립트 검증

```bash
echo "🏷️ GitHub 라벨 설정 스크립트 검증..."

if [ -f "scripts/setup_github_labels.py" ]; then
    echo "✅ 라벨 설정 스크립트 존재"
    
    echo ""
    echo "1. 스크립트 구문 검증:"
    python -m py_compile scripts/setup_github_labels.py
    if [ $? -eq 0 ]; then
        echo "  ✅ Python 구문 유효"
    else
        echo "  ❌ Python 구문 오류"
    fi
    
    echo ""
    echo "2. 스크립트 도움말 및 기본 기능:"
    python scripts/setup_github_labels.py --help 2>/dev/null || echo "  ⚠️ 도움말 기능 제한적"
    
    echo ""
    echo "3. 라벨 정의 확인:"
    # 스크립트 내용에서 라벨 정의 확인
    if grep -q "stage.*:.*data-processing" scripts/setup_github_labels.py; then
        echo "  ✅ MLOps 스테이지 라벨 정의됨"
    else
        echo "  ⚠️ MLOps 스테이지 라벨 누락"
    fi
    
    if grep -q "priority.*:" scripts/setup_github_labels.py; then
        echo "  ✅ 우선순위 라벨 정의됨"
    else
        echo "  ⚠️ 우선순위 라벨 누락"
    fi
    
    if grep -q "type.*:" scripts/setup_github_labels.py; then
        echo "  ✅ 타입 라벨 정의됨"
    else
        echo "  ⚠️ 타입 라벨 누락"
    fi
    
else
    echo "❌ 라벨 설정 스크립트 없음"
fi
```

---

## 🎯 테스트 시나리오 5: 저장소 설정 자동화 테스트

### 5.1 저장소 설정 스크립트 검증

```bash
echo "🔧 저장소 설정 자동화 스크립트 검증..."

if [ -f "scripts/setup_repository.sh" ]; then
    echo "✅ 저장소 설정 스크립트 존재"
    
    echo ""
    echo "1. 스크립트 실행 권한 확인:"
    if [ -x "scripts/setup_repository.sh" ]; then
        echo "  ✅ 실행 권한 있음"
    else
        echo "  ⚠️ 실행 권한 없음 - 권한 부여"
        chmod +x scripts/setup_repository.sh
    fi
    
    echo ""
    echo "2. 스크립트 구문 검증:"
    bash -n scripts/setup_repository.sh
    if [ $? -eq 0 ]; then
        echo "  ✅ Bash 구문 유효"
    else
        echo "  ❌ Bash 구문 오류"
    fi
    
    echo ""
    echo "3. 스크립트 기능 확인:"
    # 스크립트 내용에서 주요 기능 확인
    if grep -q "git config" scripts/setup_repository.sh; then
        echo "  ✅ Git 설정 확인 기능"
    fi
    
    if grep -q "git remote" scripts/setup_repository.sh; then
        echo "  ✅ 원격 저장소 확인 기능"
    fi
    
    if grep -q "git add\|git commit" scripts/setup_repository.sh; then
        echo "  ✅ Git 커밋 기능"
    fi
    
    if grep -q "git push" scripts/setup_repository.sh; then
        echo "  ✅ Git 푸시 기능"
    fi
    
else
    echo "❌ 저장소 설정 스크립트 없음"
fi
```

### 5.2 설정 검증 스크립트 테스트

```bash
echo "✅ 설정 검증 스크립트 테스트..."

if [ -f "scripts/validate_repository_setup.py" ]; then
    echo "✅ 설정 검증 스크립트 존재"
    
    echo ""
    echo "1. 검증 스크립트 실행:"
    python scripts/validate_repository_setup.py
    
    validation_result=$?
    if [ $validation_result -eq 0 ]; then
        echo "  ✅ 저장소 설정 검증 통과"
    else
        echo "  ⚠️ 저장소 설정에서 일부 이슈 발견"
    fi
    
else
    echo "❌ 설정 검증 스크립트 없음"
fi
```

---

## 🎯 테스트 시나리오 6: Git 상태 및 연결성 테스트

### 6.1 Git 저장소 상태 확인

```bash
echo "🔗 Git 저장소 상태 및 연결성 확인..."

echo "1. Git 저장소 초기화 확인:"
if [ -d ".git" ]; then
    echo "  ✅ Git 저장소 초기화됨"
    
    # Git 저장소 상태
    echo ""
    echo "2. Git 상태 정보:"
    echo "  - 현재 브랜치: $(git branch --show-current)"
    echo "  - 커밋 수: $(git rev-list --all --count 2>/dev/null || echo "0")"
    echo "  - 마지막 커밋: $(git log -1 --format="%h %s" 2>/dev/null || echo "없음")"
    
else
    echo "  ❌ Git 저장소 초기화되지 않음"
fi

echo ""
echo "3. 원격 저장소 연결 확인:"
if git remote -v | grep -q "origin"; then
    echo "  ✅ 원격 저장소 설정됨"
    echo "  원격 저장소:"
    git remote -v | head -2
    
    # 원격 저장소 연결 테스트 (실제 네트워크 요청 없이)
    remote_url=$(git remote get-url origin 2>/dev/null)
    if [[ "$remote_url" == https://github.com/* ]] || [[ "$remote_url" == git@github.com:* ]]; then
        echo "  ✅ GitHub 저장소 URL 형식 올바름"
    else
        echo "  ⚠️ GitHub 저장소 URL 형식 확인 필요"
    fi
    
else
    echo "  ⚠️ 원격 저장소 설정되지 않음"
fi

echo ""
echo "4. Git 사용자 설정 확인:"
git_name=$(git config user.name)
git_email=$(git config user.email)

if [ -n "$git_name" ] && [ -n "$git_email" ]; then
    echo "  ✅ Git 사용자 설정 완료"
    echo "    - 이름: $git_name"
    echo "    - 이메일: $git_email"
else
    echo "  ⚠️ Git 사용자 설정 필요"
    [ -z "$git_name" ] && echo "    - git config user.name 설정 필요"
    [ -z "$git_email" ] && echo "    - git config user.email 설정 필요"
fi
```

---

## 🎯 테스트 시나리오 7: 최종 통합 테스트

### 7.1 전체 저장소 설정 검증

```bash
echo "🔍 전체 저장소 설정 최종 검증..."

# 모든 구성 요소 체크
echo "1. 필수 구성 요소 체크:"

components=(
    "README.md:프로젝트 개요"
    "CONTRIBUTING.md:기여 가이드"
    "LICENSE:라이선스"
    ".github/PULL_REQUEST_TEMPLATE.md:PR 템플릿"
    ".github/CODEOWNERS:코드 소유자"
    "scripts/setup_github_labels.py:라벨 설정"
    "scripts/setup_repository.sh:저장소 설정"
    ".gitignore:Git 무시 설정"
)

passed_components=0
total_components=${#components[@]}

for component in "${components[@]}"; do
    file=${component%:*}
    description=${component#*:}
    
    if [ -f "$file" ] || [ -d "$file" ]; then
        echo "  ✅ $description: $file"
        ((passed_components++))
    else
        echo "  ❌ $description: $file (없음)"
    fi
done

echo ""
echo "2. 전체 구성 완성도:"
completion_rate=$((passed_components * 100 / total_components))
echo "  - 완성된 구성 요소: $passed_components/$total_components"
echo "  - 완성률: $completion_rate%"

if [ $completion_rate -ge 80 ]; then
    echo "  ✅ 저장소 설정 양호"
else
    echo "  ⚠️ 저장소 설정 보완 필요"
fi
```

### 7.2 최종 요약 및 권장사항

```bash
echo "📊 최종 요약 및 권장사항..."

echo ""
echo "🎉 3.7 GitHub Repository Setup 테스트 완료!"
echo ""

# 테스트 결과 요약
echo "✅ 완료된 테스트들:"
echo "  - 저장소 기본 파일 검증"
echo "  - GitHub 템플릿 검증"
echo "  - CODEOWNERS 설정 검증"
echo "  - 라벨 설정 스크립트 테스트"
echo "  - 저장소 설정 자동화 테스트"
echo "  - Git 상태 및 연결성 테스트"
echo "  - 전체 저장소 설정 검증"

echo ""
echo "💡 다음 단계 권장사항:"
echo "  1. GitHub에서 실제 저장소 생성 및 푸시"
echo "  2. 브랜치 보호 규칙 설정"
echo "  3. 협업자 초대 및 권한 설정"
echo "  4. GitHub Actions 워크플로우 활성화"

echo ""
if [ -n "${GITHUB_TOKEN:-}" ]; then
    echo "🏷️ GitHub 라벨 설정 실행 가능:"
    echo "   python scripts/setup_github_labels.py"
else
    echo "🏷️ GitHub 라벨 설정을 위해 GITHUB_TOKEN 환경변수 설정:"
    echo "   export GITHUB_TOKEN='your_token_here'"
    echo "   export GITHUB_REPO='username/movie-mlops'"
    echo "   python scripts/setup_github_labels.py"
fi

echo ""
echo "🚀 저장소가 협업을 위해 준비되었습니다!"
```

---

## 📋 테스트 체크리스트

### 필수 테스트 항목
- [ ] README.md 존재 및 내용 품질
- [ ] CONTRIBUTING.md 가이드 완성도
- [ ] LICENSE 파일 존재
- [ ] .gitignore 설정 적절성
- [ ] GitHub 이슈 템플릿 설정
- [ ] PR 템플릿 설정
- [ ] CODEOWNERS 파일 설정
- [ ] 라벨 설정 스크립트 정상 작동

### 자동화 테스트 항목
- [ ] 저장소 설정 스크립트 정상 작동
- [ ] 설정 검증 스크립트 정상 작동
- [ ] 라벨 설정 API 스크립트 구문 유효성
- [ ] 모든 스크립트 실행 권한 설정

### Git 통합 테스트 항목
- [ ] Git 저장소 초기화 확인
- [ ] Git 사용자 설정 완료
- [ ] 원격 저장소 연결 설정
- [ ] 브랜치 및 커밋 상태 확인

---

## 🔧 문제 해결 가이드

### 일반적인 문제들

**Q: Git 사용자 설정 누락**
```bash
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
```

**Q: GitHub 원격 저장소 설정**
```bash
git remote add origin https://github.com/USERNAME/movie-mlops.git
git branch -M main
git push -u origin main
```

**Q: 스크립트 실행 권한 오류**
```bash
chmod +x scripts/*.sh scripts/*.py
```

**Q: GitHub API 토큰 설정**
```bash
# GitHub에서 Personal Access Token 생성 후
export GITHUB_TOKEN="your_token_here"
export GITHUB_REPO="username/movie-mlops"
```

---

이 테스트 가이드를 통해 3.7 GitHub Repository Setup의 모든 구성 요소가 정상적으로 설정되었는지 체계적으로 검증할 수 있습니다.
