# 3.4 Pull Request Process Setup 테스트 가이드

## 📋 테스트 개요

**목표**: Pull Request 프로세스 설정의 모든 기능이 WSL + Docker 환경에서 정상 작동하는지 검증
**테스트 범위**: PR 템플릿, 자동화 도구, 라벨링 시스템, 품질 검사
**예상 소요 시간**: 45-60분

---

## 🧪 사전 준비

### 환경 설정 확인

```bash
# WSL Ubuntu 환경에서 실행
cd /mnt/c/dev/movie-mlops

# 현재 상태 확인
pwd
git status
git branch

# 필요 패키지 설치 확인
pip install -r docs/03-version-control/requirements-dev.txt

# Docker 서비스 확인
sudo service docker start
docker --version
```

---

## 🎯 테스트 시나리오 1: PR 프로세스 설정 검증

### 1.1 기본 파일 존재 확인

```bash
echo "📁 PR 프로세스 필수 파일 확인..."

# GitHub 템플릿 파일들
test -f .github/PULL_REQUEST_TEMPLATE.md && echo "✅ PR 템플릿 존재" || echo "❌ PR 템플릿 없음"
test -f .github/workflows/pr-validation.yml && echo "✅ PR 검증 워크플로우 존재" || echo "❌ PR 워크플로우 없음"

# 자동화 스크립트들
test -f scripts/setup_pr_labels.py && echo "✅ PR 라벨 설정 스크립트 존재" || echo "❌ 라벨 스크립트 없음"
test -f scripts/analyze_pr_size.py && echo "✅ PR 크기 분석 스크립트 존재" || echo "❌ 크기 분석 스크립트 없음"
test -f scripts/generate_pr_checklist.py && echo "✅ PR 체크리스트 생성기 존재" || echo "❌ 체크리스트 생성기 없음"
test -f scripts/pre_merge_check.py && echo "✅ Pre-merge 검증 스크립트 존재" || echo "❌ Pre-merge 스크립트 없음"
test -f scripts/pr_process_complete.sh && echo "✅ 통합 PR 프로세스 스크립트 존재" || echo "❌ 통합 스크립트 없음"

# 실행 권한 확인
chmod +x scripts/*.py scripts/*.sh
echo "✅ 스크립트 실행 권한 설정 완료"
```

### 1.2 설정 검증 스크립트 실행

```bash
echo "🔍 PR 프로세스 설정 검증 실행..."

# 검증 스크립트 실행
if [ -f "scripts/verify_pr_setup.py" ]; then
    python scripts/verify_pr_setup.py
    if [ $? -eq 0 ]; then
        echo "✅ PR 프로세스 설정 검증 통과"
    else
        echo "❌ PR 프로세스 설정 검증 실패"
        exit 1
    fi
else
    echo "❌ 검증 스크립트를 찾을 수 없습니다"
    exit 1
fi
```

---

## 🎯 테스트 시나리오 2: PR 크기 분석 도구 테스트

### 2.1 가상 변경사항 생성

```bash
echo "📝 테스트용 가상 변경사항 생성..."

# 테스트 브랜치 생성
git checkout -b test/pr-size-analysis

# 다양한 크기의 테스트 파일 생성
mkdir -p test_files

# 소규모 변경 (XS)
echo "Small change" > test_files/small_file.py
echo "def small_function(): pass" >> test_files/small_file.py

# 중간 규모 변경 (M)
for i in {1..50}; do
    echo "def function_$i():" >> test_files/medium_file.py
    echo "    return 'function $i'" >> test_files/medium_file.py
    echo "" >> test_files/medium_file.py
done

# 대규모 변경 (L)
for i in {1..200}; do
    echo "def large_function_$i():" >> test_files/large_file.py
    echo "    # This is a large function $i" >> test_files/large_file.py
    echo "    return {'data': $i, 'processed': True}" >> test_files/large_file.py
    echo "" >> test_files/large_file.py
done

# Git에 추가
git add test_files/
git commit -m "test: add test files for PR size analysis"

echo "✅ 테스트 파일 생성 완료"
```

### 2.2 PR 크기 분석 테스트

```bash
echo "📊 PR 크기 분석 도구 테스트..."

# 기본 분석
echo "1. 기본 PR 크기 분석:"
python scripts/analyze_pr_size.py

echo ""
echo "2. 상세 리포트 생성:"
python scripts/analyze_pr_size.py --report

echo ""
echo "3. 크기 제한 확인:"
python scripts/analyze_pr_size.py --check-limits

echo ""
echo "4. 베이스 브랜치 지정 테스트:"
python scripts/analyze_pr_size.py --base main --report

# 결과 검증
if [ $? -eq 0 ]; then
    echo "✅ PR 크기 분석 도구 테스트 통과"
else
    echo "❌ PR 크기 분석 도구 테스트 실패"
fi
```

---

## 🎯 테스트 시나리오 3: PR 체크리스트 생성기 테스트

### 3.1 체크리스트 생성 테스트

```bash
echo "📋 PR 체크리스트 생성기 테스트..."

# 화면 출력 테스트
echo "1. 체크리스트 화면 출력:"
python scripts/generate_pr_checklist.py

echo ""
echo "2. 체크리스트 파일 저장:"
python scripts/generate_pr_checklist.py --save

# 생성된 파일 확인
if [ -f "pr_checklist.md" ]; then
    echo "✅ 체크리스트 파일 생성됨"
    echo "📄 생성된 체크리스트 내용 미리보기:"
    head -20 pr_checklist.md
else
    echo "❌ 체크리스트 파일 생성 실패"
fi
```

### 3.2 다양한 파일 타입 반영 테스트

```bash
echo "🔄 다양한 파일 타입에 따른 체크리스트 생성 테스트..."

# Docker 파일 추가
echo "FROM python:3.11-slim" > test_files/Dockerfile.test
echo "WORKDIR /app" >> test_files/Dockerfile.test

# 설정 파일 추가
echo "test_setting: true" > test_files/config.yaml

# 테스트 파일 추가
mkdir -p test_files/tests
echo "def test_example(): assert True" > test_files/tests/test_example.py

# 문서 파일 추가
echo "# Test Documentation" > test_files/README_test.md

# Git에 추가
git add test_files/
git commit -m "test: add various file types for checklist testing"

# 체크리스트 재생성
echo "📋 다양한 파일 타입 반영된 체크리스트:"
python scripts/generate_pr_checklist.py

if [ $? -eq 0 ]; then
    echo "✅ 다양한 파일 타입 체크리스트 생성 테스트 통과"
else
    echo "❌ 체크리스트 생성 테스트 실패"
fi
```

---

## 🎯 테스트 시나리오 4: Pre-merge 검증 테스트

### 4.1 Pre-merge 검증 스크립트 테스트

```bash
echo "🔍 Pre-merge 검증 시스템 테스트..."

# 기본 검증 실행
echo "1. 기본 Pre-merge 검증:"
python scripts/pre_merge_check.py

echo ""
echo "2. 결과를 JSON으로 저장:"
python scripts/pre_merge_check.py --save-report

# 생성된 리포트 확인
if ls pre_merge_report_*.json 1> /dev/null 2>&1; then
    echo "✅ Pre-merge 리포트 파일 생성됨"
    latest_report=$(ls -t pre_merge_report_*.json | head -1)
    echo "📄 최신 리포트: $latest_report"
    
    # JSON 유효성 검사
    python -m json.tool "$latest_report" > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo "✅ JSON 리포트 형식 유효"
    else
        echo "❌ JSON 리포트 형식 오류"
    fi
else
    echo "❌ Pre-merge 리포트 파일 생성 실패"
fi
```

### 4.2 코드 품질 검증 테스트

```bash
echo "🎨 코드 품질 검증 테스트..."

# 의도적으로 형식 문제가 있는 파일 생성
cat > test_files/bad_format.py << 'EOF'
import   sys,os
def bad_function(  ):
    x=1+2
    if x==3:
        return"bad formatting"
    else:return False
EOF

git add test_files/bad_format.py
git commit -m "test: add badly formatted file for quality check"

# 코드 품질 검증 실행
echo "📊 코드 품질 검증 결과:"
python scripts/pre_merge_check.py --check-quality

# 품질 개선 후 재테스트
echo ""
echo "🔧 코드 품질 개선 후 재테스트..."

# Black으로 포맷팅
black test_files/bad_format.py 2>/dev/null || echo "Black 포맷팅 스킵"

# 수동으로 수정
cat > test_files/bad_format.py << 'EOF'
import sys
import os


def good_function():
    x = 1 + 2
    if x == 3:
        return "good formatting"
    else:
        return False
EOF

git add test_files/bad_format.py
git commit -m "fix: improve code formatting"

echo "📊 개선된 코드 품질 검증:"
python scripts/pre_merge_check.py --check-quality

if [ $? -eq 0 ]; then
    echo "✅ 코드 품질 검증 테스트 통과"
else
    echo "⚠️ 코드 품질 검증에서 일부 이슈 발견 (정상적인 동작)"
fi
```

---

## 🎯 테스트 시나리오 5: 통합 PR 프로세스 테스트

### 5.1 전체 PR 프로세스 실행

```bash
echo "🚀 통합 PR 프로세스 테스트..."

# 통합 스크립트 실행
echo "1. 통합 PR 프로세스 실행:"
bash scripts/pr_process_complete.sh

echo ""
echo "2. 베이스 브랜치 지정 실행:"
bash scripts/pr_process_complete.sh main

# 생성된 리포트 확인
if ls pr_reports/*/pr_process_summary.md 1> /dev/null 2>&1; then
    echo "✅ PR 프로세스 리포트 생성됨"
    
    latest_report_dir=$(ls -td pr_reports/*/ | head -1)
    echo "📁 최신 리포트 디렉터리: $latest_report_dir"
    
    echo "📄 생성된 파일들:"
    ls -la "$latest_report_dir"
else
    echo "❌ PR 프로세스 리포트 생성 실패"
fi
```

### 5.2 리포트 품질 검증

```bash
echo "📋 생성된 리포트 품질 검증..."

latest_report_dir=$(ls -td pr_reports/*/ | head -1)

if [ -d "$latest_report_dir" ]; then
    # 필수 파일 존재 확인
    files_to_check=(
        "pr_process_summary.md"
        "pr_size_analysis.md"
        "pr_checklist.md"
        "pre_merge_report.json"
    )
    
    for file in "${files_to_check[@]}"; do
        if [ -f "$latest_report_dir$file" ]; then
            echo "✅ $file 존재"
            
            # 파일 크기 확인 (빈 파일이 아닌지)
            if [ -s "$latest_report_dir$file" ]; then
                echo "  └─ 내용 있음"
            else
                echo "  └─ ⚠️ 빈 파일"
            fi
        else
            echo "❌ $file 없음"
        fi
    done
    
    echo ""
    echo "📊 리포트 요약 미리보기:"
    if [ -f "$latest_report_dir/pr_process_summary.md" ]; then
        head -10 "$latest_report_dir/pr_process_summary.md"
    fi
else
    echo "❌ 리포트 디렉터리를 찾을 수 없습니다"
fi
```

---

## 🎯 테스트 시나리오 6: Docker 환경 통합 테스트

### 6.1 Docker 컨테이너에서 PR 프로세스 테스트

```bash
echo "🐳 Docker 환경에서 PR 프로세스 테스트..."

# Docker 컨테이너 빌드 및 실행
if [ -f "Dockerfile.dev" ]; then
    echo "1. Docker 컨테이너 빌드:"
    docker build -f Dockerfile.dev -t movie-mlops-pr-test . > /dev/null 2>&1
    
    if [ $? -eq 0 ]; then
        echo "✅ Docker 이미지 빌드 성공"
        
        echo ""
        echo "2. 컨테이너에서 PR 프로세스 실행:"
        docker run --rm \
            -v "$(pwd):/workspace" \
            -w /workspace \
            movie-mlops-pr-test \
            bash -c "
                echo '🔍 컨테이너 내부에서 PR 프로세스 테스트'
                python scripts/analyze_pr_size.py --report
                echo '✅ Docker 환경 테스트 완료'
            "
        
        if [ $? -eq 0 ]; then
            echo "✅ Docker 환경 PR 프로세스 테스트 통과"
        else
            echo "❌ Docker 환경 PR 프로세스 테스트 실패"
        fi
        
        # 테스트용 이미지 정리
        docker rmi movie-mlops-pr-test > /dev/null 2>&1
    else
        echo "❌ Docker 이미지 빌드 실패"
    fi
else
    echo "⚠️ Dockerfile.dev를 찾을 수 없습니다. Docker 테스트 스킵"
fi
```

---

## 🎯 테스트 시나리오 7: 성능 및 확장성 테스트

### 7.1 대용량 PR 처리 성능 테스트

```bash
echo "⚡ 대용량 PR 처리 성능 테스트..."

# 대용량 변경사항 생성
echo "📝 대용량 테스트 파일 생성..."
mkdir -p test_files/performance

# 여러 개의 큰 파일 생성
for i in {1..10}; do
    echo "# Large Test File $i" > "test_files/performance/large_file_$i.py"
    for j in {1..100}; do
        echo "def function_${i}_${j}():" >> "test_files/performance/large_file_$i.py"
        echo "    \"\"\"Large function $i-$j\"\"\"" >> "test_files/performance/large_file_$i.py"
        echo "    return {'file': $i, 'function': $j}" >> "test_files/performance/large_file_$i.py"
        echo "" >> "test_files/performance/large_file_$i.py"
    done
done

git add test_files/performance/
git commit -m "test: add large files for performance testing"

# 성능 측정
echo "⏱️ PR 프로세스 성능 측정:"
start_time=$(date +%s)

python scripts/analyze_pr_size.py --report > /dev/null 2>&1
python scripts/generate_pr_checklist.py > /dev/null 2>&1
python scripts/pre_merge_check.py > /dev/null 2>&1

end_time=$(date +%s)
duration=$((end_time - start_time))

echo "📊 성능 테스트 결과:"
echo "  - 총 실행 시간: ${duration}초"
echo "  - 처리된 파일 수: $(git diff --name-only main | wc -l)"
echo "  - 변경 라인 수: $(git diff --stat main | tail -1)"

if [ $duration -lt 30 ]; then
    echo "✅ 성능 테스트 통과 (30초 이내)"
else
    echo "⚠️ 성능 개선 필요 (30초 초과)"
fi
```

---

## 🎯 테스트 시나리오 8: 오류 처리 및 복원력 테스트

### 8.1 비정상 상황 처리 테스트

```bash
echo "🛡️ 오류 처리 및 복원력 테스트..."

# 1. 빈 변경사항에 대한 처리
echo "1. 빈 변경사항 처리 테스트:"
git checkout main
git checkout -b test/empty-changes

python scripts/analyze_pr_size.py
if [ $? -eq 0 ]; then
    echo "✅ 빈 변경사항 처리 성공"
else
    echo "❌ 빈 변경사항 처리 실패"
fi

# 2. 잘못된 브랜치에서의 처리
echo ""
echo "2. 비정상적인 브랜치 상황 테스트:"
git checkout test/pr-size-analysis

# 브랜치 히스토리가 복잡한 상황 시뮬레이션
python scripts/pre_merge_check.py --base main
if [ $? -eq 0 ]; then
    echo "✅ 복잡한 브랜치 상황 처리 성공"
else
    echo "⚠️ 복잡한 브랜치 상황에서 일부 제한"
fi

# 3. 권한 문제 시뮬레이션
echo ""
echo "3. 권한 및 파일 접근 오류 처리 테스트:"

# 임시로 읽기 전용 파일 생성
echo "readonly content" > test_files/readonly.txt
chmod 444 test_files/readonly.txt

git add test_files/readonly.txt
git commit -m "test: add readonly file"

python scripts/analyze_pr_size.py --report
if [ $? -eq 0 ]; then
    echo "✅ 권한 제한 파일 처리 성공"
else
    echo "⚠️ 권한 제한 파일에서 일부 제한"
fi

# 권한 복구
chmod 644 test_files/readonly.txt
```

---

## 🎯 테스트 시나리오 9: 사용자 경험 및 접근성 테스트

### 9.1 사용자 친화적 출력 테스트

```bash
echo "👥 사용자 경험 및 접근성 테스트..."

# 1. 도움말 메시지 테스트
echo "1. 도움말 및 사용법 메시지 테스트:"
python scripts/analyze_pr_size.py --help
python scripts/generate_pr_checklist.py --help
python scripts/pre_merge_check.py --help

echo ""
echo "2. 오류 메시지 명확성 테스트:"

# 잘못된 옵션으로 실행
python scripts/analyze_pr_size.py --invalid-option 2>&1 | head -5
echo "✅ 오류 메시지 출력 확인"

# 3. 진행 상황 표시 테스트
echo ""
echo "3. 진행 상황 및 피드백 메시지 테스트:"
bash scripts/pr_process_complete.sh 2>&1 | grep -E "(✅|❌|⚠️|🔍|📊)" | head -10
echo "✅ 사용자 피드백 메시지 확인"
```

---

## 🎯 테스트 시나리오 10: 정리 및 최종 검증

### 10.1 테스트 환경 정리

```bash
echo "🧹 테스트 환경 정리..."

# 테스트 브랜치들 정리
git checkout main
git branch -D test/pr-size-analysis 2>/dev/null || true
git branch -D test/empty-changes 2>/dev/null || true

# 테스트 파일들 정리
rm -rf test_files/
rm -f pr_checklist.md
rm -f pre_merge_report_*.json
rm -rf pr_reports/

# Git 정리
git reset --hard HEAD
git clean -fd

echo "✅ 테스트 환경 정리 완료"
```

### 10.2 최종 검증 및 요약

```bash
echo "📊 최종 검증 및 테스트 요약..."

# 설정 검증 재실행
echo "🔍 최종 설정 검증:"
python scripts/verify_pr_setup.py

if [ $? -eq 0 ]; then
    echo ""
    echo "🎉 3.4 Pull Request Process Setup 테스트 완료!"
    echo ""
    echo "✅ 통과한 테스트들:"
    echo "  - PR 프로세스 설정 검증"
    echo "  - PR 크기 분석 도구"
    echo "  - PR 체크리스트 생성기"
    echo "  - Pre-merge 검증 시스템"
    echo "  - 통합 PR 프로세스"
    echo "  - Docker 환경 통합"
    echo "  - 성능 및 확장성"
    echo "  - 오류 처리 및 복원력"
    echo "  - 사용자 경험"
    echo ""
    echo "🚀 PR 프로세스가 정상적으로 구성되었습니다!"
    echo "💡 이제 실제 개발에서 활용할 수 있습니다."
else
    echo ""
    echo "❌ 일부 테스트에서 문제가 발견되었습니다."
    echo "🔧 위의 오류를 해결한 후 다시 테스트해 주세요."
fi
```

---

## 📋 테스트 체크리스트

### 필수 테스트 항목
- [ ] PR 프로세스 설정 파일 존재 확인
- [ ] PR 크기 분석 도구 정상 작동
- [ ] PR 체크리스트 생성기 정상 작동
- [ ] Pre-merge 검증 시스템 정상 작동
- [ ] 통합 PR 프로세스 스크립트 정상 작동
- [ ] Docker 환경에서 정상 작동
- [ ] 다양한 파일 타입 지원 확인
- [ ] 오류 상황 적절한 처리

### 성능 테스트 항목
- [ ] 대용량 PR 처리 성능 (30초 이내)
- [ ] 메모리 사용량 합리적 수준
- [ ] 동시 실행 가능성
- [ ] 확장 가능한 구조

### 사용성 테스트 항목
- [ ] 명확한 오류 메시지
- [ ] 도움말 메시지 제공
- [ ] 진행 상황 피드백
- [ ] 사용자 친화적 출력 형식

---

## 🔧 문제 해결 가이드

### 일반적인 문제들

**Q: 스크립트 실행 권한 오류**
```bash
chmod +x scripts/*.py scripts/*.sh
```

**Q: Python 모듈 import 오류**
```bash
# 가상환경 활성화 확인
source venv/bin/activate
pip install -r docs/03-version-control/requirements-dev.txt
```

**Q: Git 명령어 오류**
```bash
# Git 상태 확인
git status
git remote -v

# 원격 저장소 동기화
git fetch origin
```

**Q: Docker 관련 오류**
```bash
# WSL에서 Docker 서비스 시작
sudo service docker start

# Docker 권한 확인
sudo usermod -aG docker $USER
```

---

이 테스트 가이드를 통해 3.4 Pull Request Process Setup의 모든 기능이 정상적으로 작동하는지 체계적으로 검증할 수 있습니다.
