@echo off
REM ==============================================================================
REM MLOps 9μ•„ν‚¤ν…μ² Windows ν…μ¤νΈ μ‹¤ν–‰κΈ°
REM λ¨λ“  νΈν™μ„± λ° κΈ°λ¥ ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤
REM ==============================================================================

echo π§ MLOps 9μ•„ν‚¤ν…μ² ν…μ¤νΈ μ‹¤ν–‰ μ‹μ‘...

REM ==============================================================================
REM 1λ‹¨κ³„: ν™κ²½ κ²€μ¦
REM ==============================================================================
echo π“‹ 1λ‹¨κ³„: ν™κ²½ κ²€μ¦ μ¤‘...

REM Python λ²„μ „ ν™•μΈ
for /f "tokens=2" %%i in ('python --version 2^>^&1') do set PYTHON_VERSION=%%i
echo Python λ²„μ „: %PYTHON_VERSION%

REM Python 3.11 λ²„μ „ ν™•μΈ
echo %PYTHON_VERSION% | findstr /C:"3.11" >nul
if errorlevel 1 (
    echo β μ¤λ¥: Python 3.11μ΄ ν•„μ”ν•©λ‹λ‹¤. ν„μ¬ λ²„μ „: %PYTHON_VERSION%
    exit /b 1
)

REM κ°€μƒν™κ²½ ν™•μΈ
if "%VIRTUAL_ENV%"=="" (
    echo β οΈ  κ²½κ³ : κ°€μƒν™κ²½μ΄ ν™μ„±ν™”λμ§€ μ•μ•μµλ‹λ‹¤.
)

REM ==============================================================================
REM 2λ‹¨κ³„: ν¨ν‚¤μ§€ νΈν™μ„± κ²€μ‚¬
REM ==============================================================================
echo π” 2λ‹¨κ³„: ν¨ν‚¤μ§€ νΈν™μ„± κ²€μ‚¬ μ¤‘...

echo pip check μ‹¤ν–‰ μ¤‘...
pip check
if errorlevel 1 (
    echo β ν¨ν‚¤μ§€ νΈν™μ„± λ¬Έμ  λ°κ²¬
    exit /b 1
) else (
    echo β… ν¨ν‚¤μ§€ νΈν™μ„± κ²€μ‚¬ ν†µκ³Ό
)

REM ==============================================================================
REM 3λ‹¨κ³„: λ‹¨μ„ ν…μ¤νΈ μ‹¤ν–‰
REM ==============================================================================
echo π§ 3λ‹¨κ³„: λ‹¨μ„ ν…μ¤νΈ μ‹¤ν–‰ μ¤‘...

pytest tests/unit/ -v --tb=short
if errorlevel 1 (
    echo β λ‹¨μ„ ν…μ¤νΈ μ‹¤ν¨
    exit /b 1
) else (
    echo β… λ‹¨μ„ ν…μ¤νΈ ν†µκ³Ό
)

REM ==============================================================================
REM 4λ‹¨κ³„: ν†µν•© ν…μ¤νΈ μ‹¤ν–‰ (μλ” κ²½μ°)
REM ==============================================================================
echo π”— 4λ‹¨κ³„: ν†µν•© ν…μ¤νΈ ν™•μΈ μ¤‘...

dir /b tests\integration\*.py 2>nul | findstr /v "__init__.py" >nul
if not errorlevel 1 (
    echo ν†µν•© ν…μ¤νΈ μ‹¤ν–‰ μ¤‘...
    pytest tests/integration/ -v --tb=short
    if errorlevel 1 (
        echo β ν†µν•© ν…μ¤νΈ μ‹¤ν¨
        exit /b 1
    ) else (
        echo β… ν†µν•© ν…μ¤νΈ ν†µκ³Ό
    )
) else (
    echo β„ΉοΈ  ν†µν•© ν…μ¤νΈ νμΌμ΄ μ—†μµλ‹λ‹¤. κ±΄λ„λλ‹λ‹¤.
)

REM ==============================================================================
REM 5λ‹¨κ³„: E2E ν…μ¤νΈ μ‹¤ν–‰ (μλ” κ²½μ°)
REM ==============================================================================
echo π― 5λ‹¨κ³„: E2E ν…μ¤νΈ ν™•μΈ μ¤‘...

dir /b tests\e2e\*.py 2>nul | findstr /v "__init__.py" >nul
if not errorlevel 1 (
    echo E2E ν…μ¤νΈ μ‹¤ν–‰ μ¤‘...
    pytest tests/e2e/ -v --tb=short
    if errorlevel 1 (
        echo β E2E ν…μ¤νΈ μ‹¤ν¨
        exit /b 1
    ) else (
        echo β… E2E ν…μ¤νΈ ν†µκ³Ό
    )
) else (
    echo β„ΉοΈ  E2E ν…μ¤νΈ νμΌμ΄ μ—†μµλ‹λ‹¤. κ±΄λ„λλ‹λ‹¤.
)

REM ==============================================================================
REM 6λ‹¨κ³„: μ½”λ“ ν’μ§ κ²€μ‚¬ (μ„ νƒμ )
REM ==============================================================================
echo π¨ 6λ‹¨κ³„: μ½”λ“ ν’μ§ κ²€μ‚¬ μ¤‘...

where black >nul 2>&1
if not errorlevel 1 (
    echo Black ν¬λ§¤ν„° κ²€μ‚¬ μ¤‘...
    black --check .
    if errorlevel 1 (
        echo β οΈ  Black ν¬λ§¤ν„° κ¶κ³ μ‚¬ν•­ μμ
    ) else (
        echo β… Black ν¬λ§¤ν„° κ²€μ‚¬ ν†µκ³Ό
    )
) else (
    echo β„ΉοΈ  Blackμ΄ μ„¤μΉλμ§€ μ•μ•μµλ‹λ‹¤. κ±΄λ„λλ‹λ‹¤.
)

where flake8 >nul 2>&1
if not errorlevel 1 (
    echo Flake8 λ¦°ν„° κ²€μ‚¬ μ¤‘...
    flake8 src/ tests/ --max-line-length=88 --extend-ignore=E203,W503
    if errorlevel 1 (
        echo β οΈ  Flake8 λ¦°ν„° κ¶κ³ μ‚¬ν•­ μμ
    ) else (
        echo β… Flake8 λ¦°ν„° κ²€μ‚¬ ν†µκ³Ό
    )
) else (
    echo β„ΉοΈ  Flake8μ΄ μ„¤μΉλμ§€ μ•μ•μµλ‹λ‹¤. κ±΄λ„λλ‹λ‹¤.
)

REM ==============================================================================
REM μ™„λ£
REM ==============================================================================
echo.
echo π‰ λ¨λ“  ν…μ¤νΈκ°€ μ™„λ£λμ—μµλ‹λ‹¤!
echo.
echo π“ ν…μ¤νΈ μ”μ•½:
echo β… Python 3.11 ν™κ²½ ν™•μΈ
echo β… ν¨ν‚¤μ§€ νΈν™μ„± κ²€μ‚¬
echo β… λ‹¨μ„ ν…μ¤νΈ
echo β„ΉοΈ  ν†µν•© ν…μ¤νΈ (ν•„μ”μ‹)
echo β„ΉοΈ  E2E ν…μ¤νΈ (ν•„μ”μ‹)
echo β„ΉοΈ  μ½”λ“ ν’μ§ κ²€μ‚¬ (μ„ νƒμ )
echo.
echo π€ MLOps 9μ•„ν‚¤ν…μ² ν™κ²½μ΄ μ •μƒμ μΌλ΅ μ„¤μ •λμ—μµλ‹λ‹¤!

pause